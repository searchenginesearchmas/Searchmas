// Add these new variables to your script
let taskTimer = 0;
let activeTask = null;

function loop() {
    // ... inside your loop function ...

    let onAnyTask = false;
    pts.forEach((p, i) => {
        if(!tasks.done[i]) {
            ctx.fillStyle = "yellow"; 
            ctx.fillRect(p.x-15, p.y-15, 30, 30);
            
            let dist = Math.hypot(player.x-p.x, player.y-p.y);
            if(dist < 35) {
                onAnyTask = true;
                activeTask = i;
                
                // Draw a loading bar above the player
                ctx.fillStyle = "white";
                ctx.fillRect(player.x - 20, player.y - 40, 40, 5);
                ctx.fillStyle = "#0f0";
                ctx.fillRect(player.x - 20, player.y - 40, (taskTimer / 100) * 40, 5);
                
                taskTimer += 1.5; // Speed of the task (higher is faster)
                
                if(taskTimer >= 100) {
                    tasks.done[i] = true;
                    tasks.count++;
                    taskTimer = 0;
                    document.getElementById('fill').style.width = (tasks.count/4*100)+'%';
                    document.getElementById('stat').innerText = `TASKS: ${tasks.count}/4`;
                }
            }
        }
    });

    if(!onAnyTask) {
        taskTimer = 0; // Reset if you walk away
        activeTask = null;
    }
}
